<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë¬˜ë¬˜ë‹¤ê¾¸ â€” í”„ë¡œí•„</title>
  <meta name="description" content="ê³ ì–‘ì´ í”„ë¡œí•„ í˜ì´ì§€" />

  <!-- ë§ˆìŠ¤í„°í˜ì´ì§€ ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="../master.css">
  
  <!-- Instagram oEmbed -->
  <script async src="https://www.instagram.com/embed.js"></script>

  <style>
    /* í”„ë¡œí•„ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
    .wrap{ max-width:980px; margin:0 auto; padding:20px }
    .card{ background:var(--paper); border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.04) }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:14px }
    .muted{ color:var(--sub); font-size:14px }
    .btn{ appearance:none; border:1px solid var(--line); background:var(--paper); padding:8px 12px; border-radius:10px; cursor:pointer }
    .btn.primary{ border-color:var(--brand); background:linear-gradient(180deg,#fff,var(--brand2)); }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center }
    .input, textarea, select{ width:100%; padding:10px; border:1px solid var(--line); border-radius:10px; background:#fff }
    .pill{ display:inline-flex; align-items:center; gap:6px; background:#f6f6f6; border-radius:999px; padding:4px 8px; font-size:12px; border:1px solid var(--line) }
    .tag{ display:inline-flex; align-items:center; gap:6px; background:var(--brand2); border-radius:999px; padding:4px 8px; font-size:12px; border:1px solid var(--brand) }
    .paper-edge{ position:relative }
    .paper-edge:after{ content:""; position:absolute; inset:0; border-radius:16px; background:repeating-linear-gradient(45deg, transparent 0 10px, rgba(255,180,200,.2) 10px 20px); mask:linear-gradient(#000,#000) content-box, linear-gradient(#000,#000); mask-composite:exclude; padding:1px; border:1px solid transparent }
    .ghost{ opacity:.6 }
    .hide{ display:none }
    figure{ margin:0 }
    img{ max-width:100%; height:auto; border-radius:12px; border:1px solid var(--line); display:block }
  </style>
</head>
<body>
  <!-- ë§ˆìŠ¤í„°í˜ì´ì§€ í—¤ë” -->
  <header class="master-header">
    <div id="master-header"></div>
  </header>

  <!-- í˜ì´ì§€ ì½˜í…ì¸  -->
  <main class="page-content">
    <div class="wrap">
      <!-- í”„ë¡œí•„ í™ˆ -->
      <section id="page-home" class="page">
        <div class="card paper-edge">
          <div class="row" style="align-items:center;justify-content:space-between">
            <h2 id="hero-title" style="margin:0">ì˜¤ëŠ˜ì˜ ê³ ì–‘ì´ ğŸ¾</h2>
            <span class="tag"><span aria-hidden>âœ¨</span> ëœë¤ ì¹´ë“œ</span>
          </div>
          <div class="row" style="margin-top:12px;align-items:flex-start">
            <figure style="flex:1 1 320px;max-width:520px">
              <img id="hero-img" alt="ì˜¤ëŠ˜ì˜ ê³ ì–‘ì´ ì‚¬ì§„" src="https://placekitten.com/640/420"/>
              <figcaption class="muted" id="hero-caption">ëœë¤ ê³ ì–‘ì´ í”Œë ˆì´ìŠ¤í™€ë” (ë‚˜ì¤‘ì— ì¸ìŠ¤íƒ€/ê°¤ëŸ¬ë¦¬ ì—°ë™)</figcaption>
            </figure>
            <div style="flex:1 1 240px;min-width:240px">
              <p id="fortune" style="font-size:18px;line-height:1.5">ìš´ì„¸ ë¡œë”©ì¤‘â€¦</p>
              <div class="row">
                <button class="btn primary" id="btn-refresh">ì˜¤ëŠ˜ ì¹´ë“œ ìƒˆë¡œ ë½‘ê¸°</button>
                <button class="btn" id="btn-swap">ì‚¬ì§„ ë°”ê¾¸ê¸°</button>
              </div>
              <p class="muted" style="margin-top:8px">â€» ì•„ë˜ì— ìœ íŠœë¸Œ/ì¸ìŠ¤íƒ€ ìµœì‹  í¬ìŠ¤íŠ¸ ìë™ ë…¸ì¶œ</p>
            </div>
          </div>

          <hr style="margin:18px 0;border:none;border-top:1px dashed var(--line)">
          <div class="row" style="gap:16px;align-items:flex-start;flex-wrap:wrap">
            <section style="flex:1 1 420px;min-width:320px" aria-labelledby="yt-title">
              <h3 id="yt-title" style="margin:6px 0">ìœ íŠœë¸Œ ìµœì‹  ì˜ìƒ â–¶</h3>
              <div id="yt-latest" class="grid" aria-live="polite"></div>
            </section>
            <section style="flex:1 1 420px;min-width:320px" aria-labelledby="ig-title">
              <h3 id="ig-title" style="margin:6px 0">ì¸ìŠ¤íƒ€ ìµœì‹  í¬ìŠ¤íŠ¸ â™¡</h3>
              <div id="ig-latest" class="grid" aria-live="polite"></div>
            </section>
          </div>
        </div>
      </section>

      <!-- í”„ë¡œí•„: ì•„ì¹´ì´ë¸Œ -->
      <section id="page-archive" class="page hide">
        <div class="card">
          <div class="row" style="align-items:center;justify-content:space-between">
            <h2 style="margin:0">ì•„ì¹´ì´ë¸Œ ğŸ“‚</h2>
            <div class="row">
              <select id="filter-year" aria-label="ì—°ë„ ì„ íƒ" class="input" style="max-width:140px"></select>
              <select id="filter-tag" aria-label="ì¹´í…Œê³ ë¦¬ ì„ íƒ" class="input" style="max-width:160px"></select>
            </div>
          </div>
          <p class="muted">ì—°ë„/ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì •ë¦¬ëœ ê¸°ë¡. (ë°ëª¨ ë°ì´í„° â†’ ì¶”í›„ ì¸ìŠ¤íƒ€/ìœ íŠœë¸Œ ì—°ë™)</p>
          <div id="archive-list" class="grid" aria-live="polite"></div>
        </div>
      </section>

      <!-- í”„ë¡œí•„: ë°©ëª…ë¡ -->
      <section id="page-guestbook" class="page hide">
        <div class="card">
          <h2 style="margin-top:0">ë°©ëª…ë¡ âœï¸</h2>
          <p class="muted">ì†ê¸€ì”¨ ëŠë‚Œ + ìŠ¤í‹°ì»¤ë¡œ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”. (ë¡œì»¬ ì €ì¥) </p>
          <form id="guest-form" class="card" style="margin:10px 0;display:grid;gap:10px">
            <div class="row">
              <input class="input" id="nick" placeholder="ë‹‰ë„¤ì„" required aria-label="ë‹‰ë„¤ì„" style="max-width:220px"/>
              <select id="sticker" class="input" aria-label="ìŠ¤í‹°ì»¤ ì„ íƒ" style="max-width:220px">
                <option>ğŸ¾ ë°œë°”ë‹¥</option>
                <option>ğŸ± ê³ ì–‘ì´</option>
                <option>âœ¨ ë°˜ì§</option>
                <option>ğŸ€ ë¦¬ë³¸</option>
                <option>ğŸ“ ë”¸ê¸°</option>
              </select>
            </div>
            <textarea id="msg" placeholder="ë©”ì‹œì§€" required aria-label="ë©”ì‹œì§€"></textarea>
            <div class="row" style="justify-content:space-between;align-items:center">
              <button class="btn primary" type="submit">ë‚¨ê¸°ê¸°</button>
              <button class="btn" type="button" id="clear-guestbook">ëª¨ë‘ ì§€ìš°ê¸°</button>
            </div>
          </form>
          <div id="guest-list" class="grid" aria-live="polite"></div>
        </div>
      </section>

      <!-- í”„ë¡œí•„: ë³´ë„ˆìŠ¤ -->
      <section id="page-goodies" class="page hide">
        <div class="card">
          <div class="row" style="align-items:center;justify-content:space-between">
            <h2 style="margin:0">ë³´ë„ˆìŠ¤ ğŸ</h2>
            <span class="tag">coming soon</span>
          </div>
          <p class="muted">ìŠ¤í‹°ì»¤íŒ©(PNG/êµ¿ë…¸íŠ¸) ë¬´ë£Œ ë°°í¬, ë°°ê²½í™”ë©´ ë“±</p>
          <ul>
            <li>ìŠ¤í‹°ì»¤íŒ© v0: <span class="ghost">ì—…ë¡œë“œ ì˜ˆì •</span></li>
            <li>ë°°ê²½í™”ë©´ v0: <span class="ghost">ì—…ë¡œë“œ ì˜ˆì •</span></li>
          </ul>
        </div>
      </section>
    </div>
  </main>

  <!-- ë§ˆìŠ¤í„°í˜ì´ì§€ í‘¸í„° -->
  <footer class="master-footer">
    <div id="master-footer"></div>
  </footer>

  <!-- ë§ˆìŠ¤í„°í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="../master.js"></script>
  
  <script>
    // ===== ë°ì´í„°(ë””ë ‰í„°ë¦¬) =====
    const USERS = [
      { id:"myomyo", name:"ë¬˜ë¬˜",  bio:"ë‘¥ê¸€ë‘¥ê¸€ ê¿€ì  ë§ˆìŠ¤í„°", tags:["ê¿€ì ","ë¨¹ë°©"], thumb:"https://placekitten.com/420/280",
        yt:{ fallback:[/* ì˜ˆ: "dQw4w9WgXcQ" */] },
        ig:{ posts:[ /* ì˜ˆ: "https://www.instagram.com/p/BA_FzzwjgV/" */ ] },
        archive:[
          { id:1, y:2025, tag:'ë¨¹ë°©',   title:'ì¸„ë¥´ ì‹œì‹íšŒ',   img:'https://placekitten.com/420/280', note:'ì²« ì¸„ë¥´ ë¦¬ë·°', date:'2025-08-12' },
          { id:2, y:2025, tag:'ê¿€ì ',   title:'ì‹ë¹µìì„¸ ë§ˆìŠ¤í„°', img:'https://placekitten.com/421/281', note:'í–‡ì‚´ ìŠ¤íŒŸ ë°œê²¬', date:'2025-07-30' }
        ]
      },
      { id:"nabi",   name:"ë‚˜ë¹„",  bio:"ì°½ë°– êµ¬ê²½ê³¼ ê¹ƒí„¸ ì‚¬ëƒ¥", tags:["ì¥ë‚œê°","ì—¬í–‰"], thumb:"https://placekitten.com/421/281",
        yt:{ fallback:[] }, ig:{ posts:[] }, archive:[
          { id:3, y:2024, tag:'ì¥ë‚œê°', title:'ë‚šì‹œëŒ€ ê²©íŒŒ', img:'https://placekitten.com/422/282', note:'ê¹ƒí„¸ ë¶„í•´í•¨', date:'2024-12-02' }
        ]
      },
      { id:"sori",   name:"ì†Œë¦¬",  bio:"ì¸„ë¥´ í‰ê°€ë‹¨ì¥", tags:["ë¨¹ë°©"], thumb:"https://placekitten.com/422/282",
        yt:{ fallback:[] }, ig:{ posts:[] }, archive:[
          { id:4, y:2024, tag:'íŒ¨ì…˜', title:'ë¦¬ë³¸ë°ì´', img:'https://placekitten.com/423/283', note:'ë¶„í™ ë¦¬ë³¸ ì‹œë„', date:'2024-10-03' }
        ]
      }
    ];

    // ===== ê³µí†µ ìœ í‹¸ =====
    // $ì™€ $$ í•¨ìˆ˜ëŠ” master.jsì—ì„œ ì´ë¯¸ ì •ì˜ë¨
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)] }
    function qs(){ return new URLSearchParams(location.search) }

    // ===== ì¸ìŠ¤íƒ€ URL ë³´ì • =====
    function normalizeInstaPermalink(u){
      try{
        const url = new URL(u); const clean = url.pathname.replace(/\/+$/,'');
        const m = clean.match(/(?:^|\/)(?:p|reel|tv)\/([A-Za-z0-9_-]+)/);
        if(m) return `https://www.instagram.com/${clean.split('/')[1]}/${m[1]}/`;
        const m2 = clean.match(/share\/p\/([A-Za-z0-9_-]+)/);
        if(m2) return `https://www.instagram.com/p/${m2[1]}/`;
      }catch(e){}
      return u;
    }

    // ===== YouTube ì„ë² ë“œ =====
    function normalizeYtId(input){
      try{
        if(/^[A-Za-z0-9_-]{6,}$/.test(input)) return input;
        const url=new URL(input); const m1=url.pathname.match(/shorts\/([A-Za-z0-9_-]+)/); if(m1) return m1[1];
        const v=url.searchParams.get('v'); if(v) return v; const m2=url.pathname.match(/embed\/([A-Za-z0-9_-]+)/); if(m2) return m2[1];
      }catch(e){}
      return input;
    }
    function ytIframeById(id){
      const vid = normalizeYtId(id);
      const url = `https://www.youtube.com/embed/${vid}?rel=0`;
      return `<div class="card"><div style="position:relative;padding-top:56.25%"><iframe title="YouTube" src="${url}" allowfullscreen style="position:absolute;inset:0;width:100%;height:100%;border:0;border-radius:12px"></iframe></div></div>`;
    }

    // ===== í”„ë¡œí•„(í˜ì´ì§€ë“¤) ë Œë” =====
    const FORTUNES=["ì˜¤ëŠ˜ì€ ìƒì íƒí—˜ì´ ëŒ€ë°•! ğŸ“¦","ê°„ì‹ í˜‘ìƒì— ìœ ë¦¬í•œ ë‚  ğŸ—","ë‚®ì ì´ ì•½â€” 3íšŒ ì´ìƒ ì¶”ì²œ ğŸ˜´","ì°½ê°€ í–‡ì‚´ ìŠ¤íŒŸ ì„ ì  â˜€ï¸","ë¹—ì§ˆ íƒ€ì´ë° ì¢‹ìŒ âœ‚ï¸","ë‚šì‹œëŒ€ íˆíŠ¸ í™•ë¥  â†‘ ğŸ£"];
    function setFortune(){ $('#fortune').textContent = pick(FORTUNES) }
    function swapHero(){ const w=480+Math.floor(Math.random()*240), h=320+Math.floor(Math.random()*200); $('#hero-img').src=`https://placekitten.com/${w}/${h}`; $('#hero-caption').textContent='í”Œë ˆì´ìŠ¤í™€ë” â€” ë‚˜ì¤‘ì— ê°¤ëŸ¬ë¦¬/ì¸ìŠ¤íƒ€ ì—°ë™'; }

    function renderArchive(list){ 
      const wrap=$('#archive-list'); 
      if (!wrap) return;
      
      wrap.innerHTML=''; 
      list.forEach(item=>{ 
        const el=document.createElement('article'); 
        el.className='card'; 
        el.innerHTML=`<figure><img src="${item.img}" alt="${item.title}"><figcaption class='muted'>${item.date} Â· ${item.tag}</figcaption></figure><h3 style='margin:.5rem 0 0'>${item.title}</h3><p class='muted'>${item.note}</p>`; 
        wrap.appendChild(el) 
      }) 
    }
    
    function setupArchiveFilters(list){ 
      const years=[...new Set(list.map(x=>x.y))].sort((a,b)=>b-a); 
      const tags=[...new Set(list.map(x=>x.tag))]; 
      const $y=$('#filter-year'), $t=$('#filter-tag'); 
      if (!$y || !$t) return;
      
      $y.innerHTML='<option value="all">ì „ì²´ ì—°ë„</option>'+years.map(y=>`<option>${y}</option>`).join(''); 
      $t.innerHTML='<option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>'+tags.map(t=>`<option>${t}</option>`).join(''); 
      function apply(){ 
        const yv=$y.value, tv=$t.value; 
        const filtered=list.filter(x=>(yv==='all'||x.y==yv)&&(tv==='all'||x.tag===tv)); 
        renderArchive(filtered) 
      } 
      $y.onchange=$t.onchange=apply; 
      apply() 
    }

    const GKEY='guestbook.v1'; const storage={ get(k,f){ try{ return JSON.parse(localStorage.getItem(k))??f }catch{ return f } }, set(k,v){ localStorage.setItem(k, JSON.stringify(v)) } };
    function renderGuest(){ 
      const list=storage.get(GKEY,[]); 
      const wrap=$('#guest-list'); 
      if (!wrap) return;
      
      wrap.innerHTML=''; 
      if(!list.length){ 
        wrap.innerHTML='<p class="muted">ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ì–´ìš”. ì²« ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”! âœ¨</p>'; 
        return; 
      } 
      list.forEach(x=>{ 
        const el=document.createElement('article'); 
        el.className='card paper-edge'; 
        el.innerHTML=`<div class='row' style='justify-content:space-between;align-items:center'><strong>${x.nick}</strong><span class='tag'>${x.sticker}</span></div><p style='white-space:pre-wrap'>${x.msg}</p><div class='muted'>${new Date(x.ts).toLocaleString()}</div>`; 
        wrap.appendChild(el) 
      }) 
    }

    // ===== ì¸ìŠ¤íƒ€/ìœ íŠœë¸Œ ì„¹ì…˜ ë Œë” =====
    function renderInstagram(posts){ 
      const box=$('#ig-latest'); 
      if(!box) return; 
      const urls=(posts||[]); 
      if(!urls.length){ 
        box.innerHTML="<p class='muted'>í¬ìŠ¤íŠ¸ URLì„ ì‚¬ìš©ì ì„¤ì •ì— ì¶”ê°€í•˜ì„¸ìš”.</p>"; 
        return; 
      } 
      box.innerHTML = urls.map(raw=>{ 
        const permalink=normalizeInstaPermalink(raw); 
        return `<blockquote class='instagram-media' data-instgrm-permalink='${permalink}' data-instgrm-version='14' style='background:#FFF;border:0;margin:0 auto;max-width:540px;width:100%;border-radius:12px;'></blockquote>` 
      }).join(''); 
      if(window.instgrm && window.instgrm.Embeds){ 
        window.instgrm.Embeds.process(); 
      }
    }
    
    function renderYouTube(ids){ 
      const box=$('#yt-latest'); 
      if(!box) return; 
      if(!ids||!ids.length){ 
        box.innerHTML="<p class='muted'>í‘œì‹œí•  ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ìš©ì ì„¤ì •ì— IDë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</p>"; 
        return; 
      } 
      box.innerHTML = ids.map(ytIframeById).join(''); 
    }

    // ===== íƒ­ ì „í™˜ =====
    function switchTab(name){ 
      // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
      $$(".page").forEach(sec=>sec.classList.add('hide')); 
      
      // ì„ íƒëœ í˜ì´ì§€ ë³´ì´ê¸°
      $(`#page-${name}`)?.classList.remove('hide');
      
      // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const currentUser = getCurrentUser();
      if (!currentUser) return;
      
      // íƒ­ë³„ ì´ˆê¸°í™”
      switch(name) {
        case 'home':
          applyUser(currentUser);
          break;
        case 'archive':
          setupArchiveFilters(currentUser.archive || []);
          break;
        case 'guestbook':
          renderGuest();
          break;
      }
    }

    function applyUser(u){ // í—¤ë”/íƒ€ì´í‹€
      $('#hero-title').textContent = `ì˜¤ëŠ˜ì˜ ${u.name} ğŸ¾`;
      $('#hero-img').alt = `ì˜¤ëŠ˜ì˜ ${u.name} ì‚¬ì§„`;
      
      // í™ˆ ì¹´ë“œ
      setFortune(); swapHero();
      // ì•„ì¹´ì´ë¸Œ
      const list = (u.archive && u.archive.length) ? u.archive : [];
      setupArchiveFilters(list.length?list:[{y:2025,tag:'ì•ˆë‚´',title:'ì²« ê¸°ë¡ì„ ì¶”ê°€í•´ ë³´ì„¸ìš”',img:'https://placekitten.com/424/284',note:'ë°ëª¨ ì¹´ë“œ',date:new Date().toISOString().slice(0,10)}]);
      // ë°©ëª…ë¡ ë Œë”
      renderGuest();
      // ì™¸ë¶€ ì„¹ì…˜
      renderYouTube(u.yt?.fallback||[]);
      renderInstagram(u.ig?.posts||[]);
      
      // ë§ˆìŠ¤í„°í˜ì´ì§€ í—¤ë” ì—…ë°ì´íŠ¸
      if (window.updateMasterHeader) {
        window.updateMasterHeader(u.name, pick(['ê°„ì‹í™•ë¥  â†‘','ê¿€ì ë°ì´','ìº£ë‹¢ì£¼ì˜','ë°•ìŠ¤ë§¤ì§','ë¹—ì§ˆOK']));
      }
    }

    function currentUser(){ const slug=qs().get('u')||''; return USERS.find(u=>u.id===slug) }
    function getCurrentUser() { return currentUser(); }

    // ===== ì´ë²¤íŠ¸ ì„¤ì • =====
    function setupEvents() {
      // í™ˆ ì¹´ë“œ ë²„íŠ¼
      $('#btn-refresh')?.addEventListener('click', setFortune);
      $('#btn-swap')?.addEventListener('click', swapHero);
      
      // ë°©ëª…ë¡ í¼
      $('#guest-form')?.addEventListener('submit', e => {
        e.preventDefault();
        const nick = $('#nick').value.trim();
        const msg = $('#msg').value.trim();
        const sticker = $('#sticker').value;
        if (!nick || !msg) return;
        
        const list = storage.get(GKEY, []);
        list.unshift({nick, msg, sticker, ts: Date.now()});
        storage.set(GKEY, list);
        e.target.reset();
        renderGuest();
      });
      
      $('#clear-guestbook')?.addEventListener('click', () => {
        if (confirm('ë°©ëª…ë¡ì„ ì „ë¶€ ì‚­ì œí• ê¹Œìš”? (ë¡œì»¬ì— ì €ì¥ëœ ë°ì´í„°ë§Œ ì‚­ì œë©ë‹ˆë‹¤)')) {
          storage.set(GKEY, []);
          renderGuest();
        }
      });
    }

    // ===== ì´ˆê¸°í™” =====
    document.addEventListener('DOMContentLoaded', () => {
      setupEvents();
      
      // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì‚¬ìš©ìì™€ íƒ­ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const user = currentUser();
      const tab = qs().get('tab') || 'home';
      
      if (user) {
        // ì‚¬ìš©ì ì •ë³´ ì ìš©
        applyUser(user);
        
        // íƒ­ ì „í™˜
        switchTab(tab);
      } else {
        // ì‚¬ìš©ìê°€ ì—†ìœ¼ë©´ ë””ë ‰í„°ë¦¬ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html>
